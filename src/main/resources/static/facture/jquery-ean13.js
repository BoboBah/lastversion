!function(p,t,e){var i,s;s="EAN13",i=function(){function t(t,e,i){var n;if(this.element=t,this.number=e,this.settings={number:!0,prefix:!0,color:"#000",debug:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},i)for(n in i)this.settings[n]=i[n];this._name=s,this.init()}return t.prototype.settings={},t.prototype.init=function(){var t,e;return 12===this.number.length&&(t=this.generateCheckDigit(this.number),this.number+=t),13===this.number.length?(this.validate()?this.settings.onValid.call():this.settings.onInvalid.call(),e=this.getCode(),this.draw(e)):this.settings.onError.call()},t.prototype.getCode=function(){var t,e,i,n,s,r,h;for(s=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],r=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],h=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],e="",t=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"][parseInt(this.number.substr(0,1),10)].split(""),n=this.number.substr(1).split(""),i=0;i<6;)"x"===t[i]?e+=s[n[i]]:e+=r[n[i]],i++;for(i=6;i<12;)e+=h[n[i]],i++;return e},t.prototype.clear=function(t){return t.clearRect(0,0,this.element.width,this.element.height)},t.prototype.draw=function(t){var i,e,n,s,r,h,o,l,f,u,c,x,g,a,y;if(o={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},x=this.settings.prefix?this.element.width-this.element.width*o.prefix_offset:this.element.width,this.settings.number?(i=o.border_line_height_number*this.element.height,s=o.line_height*i):s=i=o.border_line_height*this.element.height,h=x/95,this.element.getContext){for(n=this.element.getContext("2d"),this.clear(n),n.fillStyle=this.settings.color,l=this.settings.number&&this.settings.prefix?this.element.width*o.prefix_offset:0,f=t.split(""),n.fillRect(l,0,h,i),l+=2*h,n.fillRect(l,0,h,i),l+=h,r=0;r<42;)"1"===f[r]&&n.fillRect(l,0,Math.floor(h)+1,s),l+=h,r++;for(l+=h,n.fillRect(l,0,h,i),l+=2*h,n.fillRect(l,0,h,i),l+=2*h,r=42;r<84;)"1"===f[r]&&n.fillRect(l,0,Math.floor(h)+1,s),l+=h,r++;if(n.fillRect(l,0,h,i),l+=2*h,n.fillRect(l,0,h,i),this.settings.number&&(n.font=o.font_size*s+"px monospace",c=this.number.substr(0,1),this.settings.prefix&&n.fillText(c,0,i*o.font_y),u=h*o.text_offset+(this.settings.prefix?o.prefix_offset*this.element.width:0),e=this.number.substr(1,6).split(""),p.each(e,function(t,e){return n.fillText(e,u,i*o.font_y),u+=o.font_stretch*x}),u=49*h+(this.settings.prefix?o.prefix_offset*this.element.width:0)+o.text_offset,p.each(this.number.substr(7).split(""),function(t,e){return n.fillText(e,u,i*o.font_y),u+=o.font_stretch*x})),this.settings.debug)for(g=a=0,y=2*h;0<y?a<=x:x<=a;g=a+=y)n.beginPath(),n.rect(g,.4*s,h,.1*s),n.fillStyle="red",n.fill();return this.settings.onSuccess.call()}return this.settings.onError.call()},t.prototype.generateCheckDigit=function(t){var e,i;return i=0,e=t.split(""),p.each(e,function(t,e){return i+=t%2==0?parseInt(e,10):3*parseInt(e,10)}),10-i%10%10},t.prototype.validate=function(){return parseInt(this.number.slice(-1),10)===this.generateCheckDigit(this.number.slice(0,-1))},t}(),p.fn[s]=function(t,e){return this.each(function(){return p.data(this,"plugin_"+s,new i(this,t,e))})}}(jQuery,window,document);